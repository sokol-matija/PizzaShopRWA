@page
@model PizzaShopWebApp.Pages.Dashboard.OrderPageModel
@{
    ViewData["Title"] = "Order Food";
    Layout = "_DashboardLayout";
}

<div class="order-container">
    <div class="order-content">
        <div class="order-header">
            <h1>Place Order</h1>
            
            <div class="search-filter-container">
                <form method="get" class="search-form">
                    <div class="search-bar">
                        <i class="bx bx-search"></i>
                        <input type="text" name="searchTerm" value="@Model.SearchTerm" placeholder="Search for food, coffee, etc.." />
                    </div>
                    
                    <div class="filter-dropdown">
                        <select name="categoryId" onchange="this.form.submit()">
                            <option value="">All Categories</option>
                            @foreach (var category in Model.Categories)
                            {
                                <option value="@category.Id" selected="@(Model.SelectedCategoryId == category.Id)">@category.Name</option>
                            }
                        </select>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="category-tabs">
            <button class="category-tab active">All</button>
            @foreach (var category in Model.Categories.Take(4)) // Limit to 4 for UI
            {
                <button class="category-tab" onclick="window.location.href='?categoryId=@category.Id'">@category.Name</button>
            }
        </div>
        
        <div class="menu-grid">
            @if (Model.Foods.Any())
            {
                @foreach (var food in Model.Foods)
                {
                    <div class="menu-item">
                        <div class="menu-item-image">
                            <img src="@(string.IsNullOrEmpty(food.ImageUrl) ? "/Images/basic_food_image.png" : food.ImageUrl)" alt="@food.Name">
                        </div>
                        <div class="menu-item-content">
                            <h3 class="menu-item-name">@food.Name</h3>
                            <p class="menu-item-price">$@food.Price.ToString("0.00")</p>
                            <p class="menu-item-available">@(food.IsPopular ? "Popular!" : "Available")</p>
                        </div>
                        <form method="post" asp-page-handler="AddToCart">
                            <input type="hidden" name="foodId" value="@food.Id" />
                            <input type="hidden" name="quantity" value="1" />
                            <button type="submit" class="add-to-cart-btn">Add to Cart</button>
                        </form>
                    </div>
                }
            }
            else
            {
                <div class="no-items-message">
                    <p>No items found. Try adjusting your search or filter.</p>
                </div>
            }
        </div>
    </div>
    
    <div class="order-sidebar">
        <div class="cart-header">
            <h2>Current Order</h2>
            @if (Model.CartItems.Any())
            {
                <form method="post" asp-page-handler="ClearCart">
                    <button type="submit" class="clear-cart-btn">Clear All</button>
                </form>
            }
        </div>
        
        <div class="cart-items">
            @if (Model.CartItems.Any())
            {
                @foreach (var item in Model.CartItems)
                {
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <h3 class="cart-item-name">@item.Name</h3>
                            <p class="cart-item-price">$@item.Price.ToString("0.00")</p>
                        </div>
                        
                        <div class="cart-item-actions">
                            <div class="quantity-controls">
                                <form method="post" asp-page-handler="UpdateCart" class="update-cart-form">
                                    <input type="hidden" name="itemId" value="@item.Id" />
                                    <button type="submit" name="quantity" value="@(item.Quantity - 1)" class="quantity-btn">-</button>
                                    <span class="quantity">@item.Quantity</span>
                                    <button type="submit" name="quantity" value="@(item.Quantity + 1)" class="quantity-btn">+</button>
                                </form>
                            </div>
                            
                            <form method="post" asp-page-handler="RemoveFromCart">
                                <input type="hidden" name="itemId" value="@item.Id" />
                                <button type="submit" class="remove-item-btn">
                                    <i class='bx bx-trash'></i>
                                </button>
                            </form>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="empty-cart">
                    <p>Your cart is empty.</p>
                    <p>Add some delicious items!</p>
                </div>
            }
        </div>
        
        <div class="cart-summary">
            <div class="summary-row">
                <span>Subtotal</span>
                <span>$@Model.GetCartTotal().ToString("0.00")</span>
            </div>
            <div class="summary-row">
                <span>Discount</span>
                <span>-$0.00</span>
            </div>
            <div class="summary-row total">
                <span>Total</span>
                <span>$@Model.GetCartTotal().ToString("0.00")</span>
            </div>
        </div>
        
        @if (Model.CartItems.Any())
        {
            <a href="/Dashboard/Payment" class="checkout-btn">
                Continue to Payment
            </a>
        }
        else
        {
            <button class="checkout-btn disabled" disabled>Continue to Payment</button>
        }
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        @TempData["ErrorMessage"]
    </div>
} 